<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/create_character.css">
        <title>CEF | CREATE CHARACTER</title>
    </head>
    <body>
        <h1 style="position: absolute; top: 20px; z-index: 10;">Создание персонажа</h1>
        <div class="content">
            <div class="left-block">
                <h2>Выберите раздел</h2>
                <div class="button-element">
                    <svg width="24" height="24" viewBox="-5 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
                            <g id="Icon-Set-Filled" sketch:type="MSLayerGroup" transform="translate(-367.000000, -309.000000)" fill="white">
                                <path d="M378,329 C382.971,329 387,324.522 387,319 C387,313.478 382.971,309 378,309 C373.029,309 369,313.478 369,319 C369,324.522 373.029,329 378,329 L378,329 Z M386.703,326.319 C384.691,329.161 381.546,331 378,331 C374.454,331 371.309,329.161 369.297,326.319 C367.904,327.411 367,329.091 367,331 L367,335 C367,338.313 369.687,341 373,341 L383,341 C386.313,341 389,338.313 389,335 L389,331 C389,329.091 388.096,327.411 386.703,326.319 L386.703,326.319 Z" id="user" sketch:type="MSShapeGroup"/>
                            </g>
                        </g>
                    </svg>
                    <span>Персонаж</span>
                </div>
                <div class="button-element">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 21C19 20.663 18.9818 20.3293 18.9463 20M5 3C5 3.33701 5.01817 3.67071 5.0537 4M5 21C5 16.8566 7.74671 13.2152 11.7307 12.077L12.2693 11.923C16.2533 10.7848 19 7.14339 19 3M15 4H5.0537M12.5 8H6.46206M9 20H18.9463M11.5 16H17.5379M18.9463 20C18.7899 18.5509 18.2974 17.187 17.5379 16M17.5379 16C16.3482 14.1405 14.5033 12.7152 12.2693 12.077L11.7307 11.923C9.49674 11.2848 7.65184 9.8595 6.46206 8M5.0537 4C5.21006 5.44909 5.70259 6.81301 6.46206 8" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Наследственность</span>
                </div>
                <div class="button-element">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="white">
                        <path d="M360-390q-21 0-35.5-14.5T310-440q0-21 14.5-35.5T360-490q21 0 35.5 14.5T410-440q0 21-14.5 35.5T360-390Zm240 0q-21 0-35.5-14.5T550-440q0-21 14.5-35.5T600-490q21 0 35.5 14.5T650-440q0 21-14.5 35.5T600-390ZM480-160q134 0 227-93t93-227q0-24-3-46.5T786-570q-21 5-42 7.5t-44 2.5q-91 0-172-39T390-708q-32 78-91.5 135.5T160-486v6q0 134 93 227t227 93Zm0 80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm-54-715q42 70 114 112.5T700-640q14 0 27-1.5t27-3.5q-42-70-114-112.5T480-800q-14 0-27 1.5t-27 3.5ZM177-581q51-29 89-75t57-103q-51 29-89 75t-57 103Zm249-214Zm-103 36Z"/>
                    </svg>
                    <span>Параметры лица</span>
                </div>
                <div class="button-element">
                    <svg fill="white" height="24" width="24" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
	                    viewBox="0 0 157 256" xml:space="preserve">
                        <path d="M129.7,31.6H92.7c-6.6-0.1-6.4,9.8,0,9.8h36.9v4.9H92.9c-6.7,0-6.5,9.8,0,9.8h36.8v4.9v0.2H92.9c-6.7,0-6.5,9.9,0,9.9h36.8
                            v4.9H92.9c-6.6,0-6.5,9.8,0,9.8h36.8v4.9H92.9c-6.6,0-6.6,9.9,0,9.8h36.8v5H92.9c-6.6-0.1-6.6,9.8,0,9.8h36.8v4.9H92.9
                            c-6.6,0-6.6,9.8,0,9.8h36.8v4.9H92.9c-6.6,0-6.5,9.9,0,9.9h36.8v95.5c-0.1,14.6,22.2,14.4,22.2,0V16.9c0-6.6-5.5-15-14.6-15
                            L92.7,1.8c-6.6,0.1-6.4,9.9,0,9.9h36.9v4.9H92.7c-6.6,0-6.4,9.9,0,9.8h36.9V31.6L129.7,31.6z"/>
                        <path d="M87,224.6c-1.3,8.1,1.5,22.6,7.2,27.9c6,5.5,13.1-1.5,10.2-7.2c-3-5.6-6.7-8.7-3.6-22.1L87,224.6L87,224.6z"/>
                        <path d="M30.1,201"/>
                        <path d="M75.2,177.5v-65.1L62.9,5.3c-0.4-2.9-2.1-3.6-3.8-3.6c-1.6,0-3.4,0.6-3.7,3.6l-12,107.1v65.1c-22.7-11.8-39.7,6.6-39.8,23.3
                            c0.1,14.9,11.1,27.2,26.8,27.2c15.7-0.1,26.4-13.8,26.4-27.2v-65.4h5v65.4c0,15.5,12.6,27,26,27c16.9,0,27.6-11.9,27.6-26.9
                            C115.5,184,97.9,165.7,75.2,177.5z M30.1,214.4c-7.4,0-13.3-6-13.4-13.4c0.1-7.3,6-13.3,13.4-13.3c7.4,0,13.4,5.9,13.4,13.3
                            C43.5,208.4,37.5,214.4,30.1,214.4z M88.9,214.4c-7.3,0-13.3-6-13.3-13.4c0-7.3,5.9-13.3,13.3-13.3c7.4,0,13.4,5.9,13.4,13.3
                            C102.3,208.4,96.4,214.4,88.9,214.4z"/>
                        <path d="M88.9,201"/>
                    </svg>
                    <span>Волосы</span>
                </div>
                <div class="button-element">
                    <svg fill="white" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3.105,12.447a1,1,0,0,0,1.45.385L6,11.869V21a1,1,0,0,0,1,1H17a1,1,0,0,0,1-1V11.869l1.445.963a1,1,0,0,0,1.45-.385l2-4a1,1,0,0,0-.114-1.072l-4-5A1,1,0,0,0,18,2H15a1,1,0,0,0-1,1,2,2,0,0,1-4,0A1,1,0,0,0,9,2H6a1,1,0,0,0-.781.375l-4,5a1,1,0,0,0-.114,1.072ZM6.48,4H8.127a4,4,0,0,0,7.746,0H17.52l3.3,4.125L19.612,10.54,17.555,9.168A1,1,0,0,0,16,10V20H8V10a1,1,0,0,0-1.555-.832L4.388,10.54,3.181,8.125Z"/>
                    </svg>
                    <span>Одежда</span>
                </div>
            </div>
            <div class="center-block">
                <button id="submit" class="save">Сохранить</button>
            </div>
            <div class="left-block" style="padding: 20px 40px;">
                <form class="character-data" id="character-data-form">
                    <div class="label-input">
                        <label>Укажите имя</label>
                        <input placeholder="John_Smith" id="character-name" name="name">
                    </div>
                    <div class="label-input">
                        <label>Укажите возраст</label>
                        <input type="number" placeholder="21" name="age">
                    </div>
                    <div class="label-input">
                        <label>Выберите пол</label>
                        <div class="sex-select">
                            <button type="button" class="active male" id="sex-male">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M15 3C15 2.44772 15.4477 2 16 2H20C21.1046 2 22 2.89543 22 4V8C22 8.55229 21.5523 9 21 9C20.4477 9 20 8.55228 20 8V5.41288L15.4671 9.94579C15.4171 9.99582 15.363 10.0394 15.3061 10.0767C16.3674 11.4342 17 13.1432 17 15C17 19.4183 13.4183 23 9 23C4.58172 23 1 19.4183 1 15C1 10.5817 4.58172 7 9 7C10.8559 7 12.5642 7.63197 13.9214 8.69246C13.9587 8.63539 14.0024 8.58128 14.0525 8.53118L18.5836 4H16C15.4477 4 15 3.55228 15 3ZM9 20.9963C5.68831 20.9963 3.00365 18.3117 3.00365 15C3.00365 11.6883 5.68831 9.00365 9 9.00365C12.3117 9.00365 14.9963 11.6883 14.9963 15C14.9963 18.3117 12.3117 20.9963 9 20.9963Z" fill="white"/>
                                </svg>
                            </button>
                            <button type="button" class="female" id="sex-female">
                                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M20 9C20 13.0803 16.9453 16.4471 12.9981 16.9383C12.9994 16.9587 13 16.9793 13 17V19H14C14.5523 19 15 19.4477 15 20C15 20.5523 14.5523 21 14 21H13V22C13 22.5523 12.5523 23 12 23C11.4477 23 11 22.5523 11 22V21H10C9.44772 21 9 20.5523 9 20C9 19.4477 9.44772 19 10 19H11V17C11 16.9793 11.0006 16.9587 11.0019 16.9383C7.05466 16.4471 4 13.0803 4 9C4 4.58172 7.58172 1 12 1C16.4183 1 20 4.58172 20 9ZM6.00365 9C6.00365 12.3117 8.68831 14.9963 12 14.9963C15.3117 14.9963 17.9963 12.3117 17.9963 9C17.9963 5.68831 15.3117 3.00365 12 3.00365C8.68831 3.00365 6.00365 5.68831 6.00365 9Z" fill="white"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="notify" id="notify-block">
            <span class="icon error" id="notify-error-icon">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed">
                    <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/>
                </svg>
            </span>
            <span class="icon success" id="notify-success-icon">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed">
                    <path d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z"/>
                </svg>
            </span>
            <p id="notify-message">Ошибка</p>
        </div>
        
        <script>
            let selectedSex = 0;
            let notifyTimer = null;
            const nameInput = document.getElementById("character-name");
            function setNotify(value, isSuccess) {
                const notifySuccessIcon = document.getElementById('notify-success-icon');
                const notifyErrorIcon = document.getElementById('notify-error-icon');
                if (isSuccess) {
                    notifyErrorIcon.style.display = 'none';
                    notifySuccessIcon.style.display = 'flex';
                } else {
                    notifySuccessIcon.style.display = 'none';
                    notifyErrorIcon.style.display = 'flex';
                }

                const notifyBlock = document.getElementById('notify-block');
                const notifyContent = document.getElementById('notify-message');
                notifyContent.textContent = value;
                notifyBlock.style.opacity = 1;
                notifyTimer = setTimeout(() => {
                    notifyBlock.style.opacity = 0;
                    clearTimeout(notifyTimer);
                }, 3000);
                
            }
            document.getElementById('submit').addEventListener('click', function() {
                const dataCharacterForm = document.getElementById('character-data-form');
                const nameValue = dataCharacterForm.elements['name'].value;
                const namePattern = /^[A-Z][a-z]*_[A-Z][a-z]*([A-Z][a-z]*)?$/;
                if(!nameValue.match(namePattern)) {
                    setNotify("Имя должно быть формата Имя_Фамилия", false);
                    return;
                }

                if(nameValue.length < 4 || nameValue.length > 64) {
                    setNotify("Длина имени не может быть менее 4 или более 64 символов", false);
                    return;
                }

                const ageValue = dataCharacterForm.elements['age'].value;
                const agePattern = /^-?\d+(\.\d+)?$/;
                if(!ageValue.match(agePattern)) {
                    setNotify("Некорректный возраст", false);
                    return;
                }
                if(ageValue < 18 || ageValue > 60) {
                    setNotify("Возраст не может быть менее 18 или более 60 лет");
                    return;
                }

                const registerButton = document.getElementById('submit');
                registerButton.textContent = 'ЗАГРУЗКА';
                registerButton.disabled = true;

                mp.trigger("CEF:CLIENT::PERSON_CREATE_BUTTON_CLICKED", nameValue, ageValue, selectedSex);
                
            });
            document.addEventListener('personExist', function(e) {
                setNotify("Персонаж с таким именем уже существует", false);
                const registerButton = document.getElementById('submit');
                registerButton.textContent = 'Сохранить';
                registerButton.disabled = false;
            });
            document.getElementById('sex-male').addEventListener('click', function() {
                const maleButton = document.getElementById('sex-male');
                maleButton.classList.add('active');
                const femaleButton = document.getElementById('sex-female');
                femaleButton.classList.remove('active');
                nameInput.placeholder = "John_Smith";
                selectedSex = 0;
            });
            document.getElementById('sex-female').addEventListener('click', function() {
                const maleButton = document.getElementById('sex-male');
                maleButton.classList.remove('active');
                const femaleButton = document.getElementById('sex-female');
                femaleButton.classList.add('active');
                nameInput.placeholder = "Mary_Smith";
                selectedSex = 1;
            });
        </script>
    </body>
</html>
